<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ajout un adhérent</title>
    <link rel="stylesheet" href="css/adherents.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="css/emprunts.css" />
  </head>

  <body>
    <header>
      <div class="container">
        <div class="haut">
          <div class="logo">
            <img src="./images/logo.png" alt="logo" />
            <a class="alogo" href="#">Marmusots</a>
          </div>
          <div id="monCompte" class="right clear">
            <i class="fa-regular fa-user"></i>
            <div class="left">
              <button onclick="hideAndReplace()">Mon compte Adherant</button>
              <button onclick="showOriginal()">Mon compte Employer</button>
            </div>
          </div>
        </div>
        <!-- 
        <nav id="navbarEmployer" class="navbar">
          <a href="#">Ajouter un adhérent</a>
          <a href="#">Gestion des Emprunts</a>
          <a href="#">Gestion des séries</a>
          <a id="aDernier" href="#">Gestion des BD</a>
        </nav>

        <nav id="navbarAdherant" class="navbar" style="display: none">
          <a href="#">Mes informations</a>
          <a href="#">Mes Emprunts</a>
          <a href="#">Gestion des séries</a>
          <a id="aDernier" href="#">Gestion des BD</a>
        </nav>-->
      </div>
    </header>

    <main class="containerMain">
      <section>
        <a id="emprunt" href="ad.html" class="nav-link">Ajouter un adhérent</a>
        <a id="retour" href="liste-adherents.html" class="nav-link"
          >Liste de tous les adhérents
        </a>
      </section>

      <aside>
        <!-- Formulaire de recherche d'adhérent -->
        <!--<form id="rechercheAdherentForm">
          <label for="searchAdherent"
            >Rechercher Adhérent
            <i class="fas fa-info-circle" onclick="afficherInfo()"></i> :</label
          ><br /><br />
          <div class="input-container">
            <input
              type="text"
              id="searchAdherent"
              name="searchAdherent"
              required
            />
          <input type="text" id="searchPrenom" name="searchAdherent" required>
            <button type="button" onclick="rechercherAdherent()">
              Rechercher
            </button>
          </div>
        </form>-->
        <br /><br />

        <!-- Résultats de la recherche -->
        <div id="resultatsRecherche"></div>
        <br /><br />

        <!-- <p id="titreEnregistrer">Ajouter un adhérent :</p>-->
        <br /><br />

        <div id="listePrets"></div>
        <form id="adherentForm">
          <label for="nom">Nom :</label>
          <input type="text" id="nom" name="nom" required /><br /><br />

          <label for="prenom">Prénom :</label>
          <input type="text" id="prenom" name="prenom" required /><br /><br />

          <label for="email">Email :</label>
          <input type="email" id="email" name="email" required /><br /><br />

          <button id="bValider" type="submit">Ajouter</button>
          <button id="modifierBtn-${codeAdherent}" type="submit" class="hidden">
            Enregistrer
          </button>
          <button
            id="supprimerBtn-${codeAdherent}"
            type="submit"
            class="hidden"
          >
            Supprimer
          </button>
          <button id="bAnnuler" href="">Annuler</button>
        </form>
        <p id="messageAjout" style="text-align: center"></p>
        <p id="messageModification" style="text-align: center"></p>
        <p id="messageSuppression" style="text-align: center"></p>
        <div id="messageErreur" style="color: red; text-align: center"></div>
        <div id="errorMessageContainer" style="text-align: center"></div>
      </aside>
    </main>

    <!-- <h1>Ajout adhérents</h1> -->

    <p id="messageAjout"></p>

    <h2 class="aj">Adhérents :</h2>

    <div id="tableContainer" class="hide">
      <table id="listePers" class="table table-bordered border-black">
        <thead>
          <tr>
            <th scope="col" class="col-2">Id</th>
            <th scope="col" class="col-2">Nom</th>
            <th scope="col" class="col-2">Prenom</th>
            <th scope="col" class="col-2">Email</th>
            <th scope="col" class="col-2">Actions</th>
          </tr>
        </thead>
        <tbody class="table-group-divider" id="tableId"></tbody>
      </table>
    </div>

    <script src="js/liste-adherents.js"></script>
    <script src="js/modifier.js"></script>
    <script src="js/supprimer.js"></script>
    <!--   <script>
     /*   this.adherents = new Map([
        [
          "001",
          {
            codeAdherent: "001",
            nom: "Dupont",
            prenom: "Jean",
            email: "jean.dupont@email.com",
            emprunts: [],
            login: "Dupont.ad",
            password: "jeandupont!",
          },
        ],
        [
          "002",
          {
            "code adhérent": "002",
            nom: "Martin",
            prenom: "Sophie",
            email: "sophie.martin@email.com",
            emprunts: [],
            login: "Martin.so",
            password: "sophiemartin!",
          },
        ],
        [
          "003",
          {
            "code adhérent": "003",
            nom: "Lefevre",
            prenom: "Pierre",
            email: "pierre.lefevre@email.com",
            emprunts: [],
            login: "Lefevre.pi",
            password: "pierrelefevre!",
          },
        ],
        [
          "004",
          {
            "code adhérent": "004",
            nom: "Dufour",
            prenom: "Marie",
            email: "marie.dufour@email.com",
            emprunts: [],
            login: "Dufour.ma",
            password: "mariedufour!",
          },
        ],
        [
          "005",
          {
            "code adhérent": "005",
            nom: "Leroy",
            prenom: "Lucas",
            email: "lucas.leroy@email.com",
            emprunts: [],
            login: "Leroy.lu",
            password: "lucasleroy!",
          },
        ],
        [
          "006",
          {
            "code adhérent": "006",
            nom: "Bertrand",
            prenom: "Anna",
            email: "anna.bertrand@email.com",
            emprunts: [],
            login: "Bertrand.an",
            password: "annabertrand!",
          },
        ],
      ]);

var adherents = new Map();

adherents.set("001", {
  codeAdherent: "001",
  nom: "Dupont",
  prenom: "Jean",
  email: "jean.dupont@email.com",
  dateAdhesion: new Date("2022-12-10"),
  login: "Dupont.ad",
  pass: "jeandupont!",
});

adherents.set("002", {
  codeAdherent: "002",
  nom: "Martin",
  prenom: "Sophie",
  email: "sophie.martin@email.com",
  dateAdhesion: new Date("2022-12-11"),
  login: "Martin.so",
  pass: "sophiemartin!",
});

adherents.set("003", {
  codeAdherent: "003",
  nom: "Lefevre",
  prenom: "Pierre",
  email: "pierre.lefevre@email.com",
  dateAdhesion: new Date("2022-12-12"),
  login: "Lefevre.pi",
  pass: "pierrelefevre!",
});

adherents.set("004", {
  codeAdherent: "004",
  nom: "Dufour",
  prenom: "Marie",
  email: "marie.dufour@email.com",
  dateAdhesion: new Date("2022-12-13"),
  login: "Dufour.ma",
  pass: "mariedufour!",
});

adherents.set("005", {
  codeAdherent: "005",
  nom: "Leroy",
  prenom: "Lucas",
  email: "lucas.leroy@email.com",
  dateAdhesion: new Date("2022-12-14"),
  login: "Leroy.lu",
  pass: "lucasleroy!",
});

adherents.set("006", {
  codeAdherent: "006",
  nom: "Bertrand",
  prenom: "Anna",
  email: "anna.bertrand@email.com",
  dateAdhesion: new Date("2022-12-15"),
  login: "Bertrand.an",
  pass: "annabertrand!",
});

// Affichage des résultats dans la console (facultatif)
adherents.forEach((value, key) => {
  console.log(key, value);
});
 
function Adherent(nom, prenom, email) {
        this.nom = nom;
        this.prenom = prenom;
        this.email = email;
      }

      // Fonction pour afficher les détails des adhérents
      function afficherDetailsAdherents() {
        const detailsAdherentsElement =
          document.getElementById("detailsAdherents");

        // Nettoie le contenu actuel des détails des adhérents
        /*  detailsAdherentsElement.innerHTML = "";

        
        this.adherents.forEach((adherent, id) => {
          const detailsAdherent = document.createElement("div");
          detailsAdherent.classList.add("adherent-details");

          detailsAdherent.innerHTML = `
          <p>ID: ${id}</p>
          <p>Nom: ${adherent.nom}</p>
          <p>Prénom: ${adherent.prenom}</p>
          <p>Email: ${adherent.email}</p>
          <p>--------------</p>
        `;

          detailsAdherentsElement.appendChild(detailsAdherent);
        });
      }

      // Appelez cette fonction pour afficher les détails des adhérents dans votre interface utilisateur
      afficherDetailsAdherents();

      // Création d'une liste vide d'adhérents
      let listeAdherents = [];

      const form = document.getElementById("adherentForm");
      const listeAdherentsElement = document.getElementById("listeAdherents");
      const modifierAdherentForm = document.getElementById(
        "modifierAdherentForm"
      ); 

      const messageModification = document.getElementById(
        "messageModification"
      );
      const messageAjout = document.getElementById("messageAjout");

      // Cette fonction supprime le contenu du message après un délai de 3 secondes
      function clearMessage(element) {
        setTimeout(function () {
          element.textContent = "";
        }, 3000);
      }

      form.addEventListener("submit", function (event) {
        event.preventDefault();

        const nom = document.getElementById("nom").value;
        const prenom = document.getElementById("prenom").value;
        const email = document.getElementById("email").value;

        if (emailExists(email)) {
          alert(
            "L'adresse email est déjà utilisée. Veuillez entrer une autre adresse email."
          );
          return;
        }

        ajouterAdherent(nom, prenom, email);
        afficherAdherents();
        form.reset();

        messageAjout.textContent = "Un nouvel adhérent a été ajouté.";
        clearMessage(messageAjout);
      });



      modifierAdherentForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const nom = document.getElementById("nomModifier").value;
        const prenom = document.getElementById("prenomModifier").value;
        const nouvelEmail = document.getElementById("nouvelEmail").value;

        modifierAdherent(nom, prenom, nouvelEmail);
        modifierAdherentForm.reset();
      });

      function ajouterAdherent(nom, prenom, email) {
        let nouvelAdherent = new Adherent(nom, prenom, email);
        // Initialise la propriété 'anciennesAdresses' pour chaque nouvel adhérent
        nouvelAdherent.anciennesAdresses = [];

        listeAdherents.push(nouvelAdherent);
      }

      function afficherAdherents() {
        const tableIdElement = document.getElementById("tableId");
        tableIdElement.innerHTML = ""; // Nettoie le contenu actuel

        listeAdherents.forEach(function (adherent, index) {
          // Crée une nouvelle ligne pour chaque adhérent
          const tableRow = document.createElement("tr");

          // Remplit la ligne avec les détails de l'adhérent
          tableRow.innerHTML = `
      <td class="col-2">${index + 1}</td>
      <td class="col-2">${adherent.nom}</td>
      <td class="col-2">${adherent.prenom}</td>
      <td class="col-2">${adherent.email}</td>
      <td class="col-2">
        <button onclick="editerAdherent(${index + 1})">Éditer</button>
        <button onclick="supprimerAdherent(${index + 1})">Supprimer</button>
      </td>
    `;

          // Ajoute la ligne à la table
          tableIdElement.appendChild(tableRow);
        });

        // Vous pouvez également ajouter ici le code pour afficher le conteneur du tableau
        const tableContainer = document.getElementById("tableContainer");
        tableContainer.classList.remove("hide");
      }

      function emailExists(email) {
        return listeAdherents.some((adherent) => adherent.email === email);
      }*/
      /*    function modifierAdherent(nom, prenom, nouvelEmail) {
        let found = false;

        for (let i = 0; i < listeAdherents.length; i++) {
          if (
            listeAdherents[i].nom === nom &&
            listeAdherents[i].prenom === prenom
          ) {
            if (
              emailExists(nouvelEmail) &&
              listeAdherents[i].email !== nouvelEmail &&
              listeAdherents[i].anciennesAdresses.includes(nouvelEmail)
            ) {
              alert(
                "Vous avez déjà changé l'adresse email de cet utilisateur avec cette adresse. Veuillez utiliser une autre adresse email."
              );
              return;
            }

            if (emailExists(nouvelEmail)) {
              alert(
                "L'adresse email est déjà utilisée par un autre adhérent. Veuillez entrer une autre adresse email."
              );
              return;
            }

            if (
              emailExists(nouvelEmail) &&
              listeAdherents[i].email !== nouvelEmail
            ) {
              if (
                !listeAdherents[i].anciennesAdresses.includes(
                  listeAdherents[i].email
                )
              ) {
                listeAdherents[i].anciennesAdresses.push(
                  listeAdherents[i].email
                );
              }
            }

            listeAdherents[i].email = nouvelEmail;
            found = true;
            updateAdherentInList(i);
            break;
          }
        }

        if (!found) {
          console.log("Adhérent non trouvé");
        } else {
          messageModification.textContent = `L'adresse email de l'adhérent ${prenom} ${nom} a été modifiée.`;
          setTimeout(() => {
            messageModification.textContent = "";
          }, 3000);
        }
      }

      function updateAdherentInList(index) {
        const updatedAdherent = listeAdherents[index];
        const listItemToUpdate = listeAdherentsElement.childNodes[index];

        listItemToUpdate.innerHTML = `Adhérent ${index + 1}:<br>Nom: ${
          updatedAdherent.nom
        }<br>Prénom: ${updatedAdherent.prenom}<br>Email: ${
          updatedAdherent.email
        }<br>--------------`;
      }

    
      const supprimerAdherentForm = document.getElementById(
        "supprimerAdherentForm"
      );
      const messageSuppression = document.getElementById("messageSuppression");

      supprimerAdherentForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const nom = document.getElementById("nomSupprimer").value;
        const prenom = document.getElementById("prenomSupprimer").value;
        const email = document.getElementById("emailSupprimer").value;

        supprimerAdherent(nom, prenom, email);
        supprimerAdherentForm.reset();
      });

      function supprimerAdherent(nom, prenom, email) {
        let found = false;
        for (let i = 0; i < listeAdherents.length; i++) {
          if (
            listeAdherents[i].nom === nom &&
            listeAdherents[i].prenom === prenom &&
            listeAdherents[i].email === email
          ) {
            listeAdherents.splice(i, 1); // Supprime l'adhérent du tableau
            found = true;
            afficherAdherents(); // Met à jour l'affichage de la liste des adhérents
            break;
          }
        }

        if (!found) {
          messageSuppression.textContent = "Adhérent non trouvé.";
          setTimeout(() => {
            messageSuppression.textContent = "";
          }, 3000);
        } else {
          messageSuppression.textContent = `L'adhérent ${prenom} ${nom} a été supprimé.`;
          setTimeout(() => {
            messageSuppression.textContent = "";
          }, 3000);
        }
      }*/
    </script>-->
  </body>
</html>
