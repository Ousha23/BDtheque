<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ajouter un adhérent</title>
    <link rel="stylesheet" href="css/adherents.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="css/emprunts.css">
  </head>

  <body>


    
    <header>
      <div class="container">
          <div class="haut"> 
              <div class="logo"> 
                  <img src="./images/logo.png" alt="logo">   
                  <a class="alogo" href="#">Marmusots</a>
              </div>
              <div id="monCompte" class="right clear">
                  <i class="fa-regular fa-user"></i>
                  <div class="left">
                      <button onclick="hideAndReplace()">Mon compte Adherant</button>
                      <button onclick="showOriginal()">Mon compte Employer</button>
                  </div>
              </div>

          </div>
      
          <nav id="navbarEmployer" class="navbar">
              <a href="#">Ajouter un adhérent</a>
              <a href="#">Gestion des Emprunts</a>
              <a href="#">Gestion des séries</a>
              <a id="aDernier" href="#">Gestion des BD</a>
          </nav>

          <nav id="navbarAdherant" class="navbar" style="display: none;">
              <a href="#">Mes informations</a>
              <a href="#">Mes Emprunts</a>
              <a href="#">Gestion des séries</a>
              <a id="aDernier" href="#">Gestion des BD</a>
          </nav>
      
  </header>



  <main class="containerMain"> 

    <section>

        <a id="emprunt" href="gestion_emprunts.html?type=emprunt" class="nav-link">Enregistrer un prêt</a>
        <a  id="retour" href="gestion_retour.html?type=retour" class="nav-link">Enregistrer un retour</a>
    </section>

    <aside> 
        <!-- Formulaire de recherche d'adhérent -->
        <form id="rechercheAdherentForm">
        
            
                <label for="searchAdherent" >Rechercher Adhérent  <i class="fas fa-info-circle" onclick="afficherInfo()"></i> :</label><br><br>
            <div class="input-container"> 
                <input type="text" id="searchAdherent" name="searchAdherent" required>
            <!-- <input type="text" id="searchPrenom" name="searchAdherent" required>-->
                <button type="button" onclick="rechercherAdherent()">Rechercher</button>
            </div>
                
           
        </form><br><br>

        <!-- Résultats de la recherche -->
        <div id="resultatsRecherche"></div><br><br>

        <p id="titreEnregistrer">Ajouter un adhérent :</p><br><br>
 <p id="messageAjout" style="text-align: center;"></p>
 <p id="messageModification" style="text-align: center;"></p>
  <p id="messageSuppression" style="text-align: center;" ></p>
  <div id="errorMessageContainer" style="text-align: center;" ></div>

        <!-- Formulaire de création de prêt -->
       <!-- <form id="adherentForm">
           <div>
              <label for="nom">Nom :</label>
      <input type="text" id="nom" name="nom" required />
           </div> 
      <br /><br />
           <div>
         <label for="prenom">Prénom :</label>
      <input type="text" id="prenom" name="prenom" required />
           </div>
     <br /><br />
           <div>
         <label for="email">Email :</label>
      <input type="email" id="email" name="email" required />
           </div>
    <br /><br />
          
            <br><br>
          
          <button id="bValider" type="submit">Ajouter Adhérent</button>
     
            <button id="bValider" type="button" onclick="enregistrerEmprunt()">Valider</button>
            <button id="bAnnuler" type="button" onclick="annulerFormulaire()">Annuler</button>
            
            
        </form><br><br>
-->
        <!-- Affichage des prêts éventuels -->
        <div id="listePrets"></div>
    </aside>
</main>

    <h1>Gestion des adhérents</h1>

    <form id="adherentForm">
      <label for="nom">Nom :</label>
      <input type="text" id="nom" name="nom" required /><br /><br />

      <label for="prenom">Prénom :</label>
      <input type="text" id="prenom" name="prenom" required /><br /><br />

      <label for="email">Email :</label>
      <input type="email" id="email" name="email" required /><br /><br />

      <button type="submit">Ajouter Adhérent</button>
    </form>

   
    <h2>Liste des adhérents :</h2>
    <ul id="listeAdherents"></ul>

    <h2>Détails des adhérents :</h2>
    <div id="detailsAdherents"></div>

    <h2>Modifier l'email d'un adhérent :</h2>
    <form id="modifierAdherentForm">
      <label for="nomModifier">Nom :</label>
      <input
        type="text"
        id="nomModifier"
        name="nomModifier"
        required
      /><br /><br />

      <label for="prenomModifier">Prénom :</label>
      <input
        type="text"
        id="prenomModifier"
        name="prenomModifier"
        required
      /><br /><br />

      <label for="nouvelEmail">Nouvel Email :</label>
      <input
        type="email"
        id="nouvelEmail"
        name="nouvelEmail"
        required
      /><br /><br />

      <button type="submit">Modifier Email Adhérent</button>
    </form>

   
    <h2>Supprimer un adhérent :</h2>
    <form id="supprimerAdherentForm">
      <label for="nomSupprimer">Nom :</label>
      <input
        type="text"
        id="nomSupprimer"
        name="nomSupprimer"
        required
      /><br /><br />

      <label for="prenomSupprimer">Prénom :</label>
      <input
        type="text"
        id="prenomSupprimer"
        name="prenomSupprimer"
        required
      /><br /><br />

      <label for="emailSupprimer">Email :</label>
      <input
        type="email"
        id="emailSupprimer"
        name="emailSupprimer"
        required
      /><br /><br />

      <button type="submit">Supprimer Adhérent</button>
    </form>

  
   <!-- <p id="messageSuppression"></p>
       <script src="js/adherents.js"></script>-->


    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="js/exemplaires.js"></script>
    <script src="js/albums.js"></script>
   <!--  <script src="js/adherents.js"></script>
    <script src="js/class_Emprunts.js"></script>
    <script src="js/body.js"></script>
    <script src="js/gestion_emprunts.js"></script>-->
   
   

   
    <script>
   
      // Fonction pour afficher les détails des adhérents
      function afficherDetailsAdherents() {
        const detailsAdherentsElement =
          document.getElementById("detailsAdherents");

        // Nettoie le contenu actuel des détails des adhérents
        detailsAdherentsElement.innerHTML = "";

        /*
        this.adherents.forEach((adherent, id) => {
          const detailsAdherent = document.createElement("div");
          detailsAdherent.classList.add("adherent-details");

          detailsAdherent.innerHTML = `
          <p>ID: ${id}</p>
          <p>Nom: ${adherent.nom}</p>
          <p>Prénom: ${adherent.prenom}</p>
          <p>Email: ${adherent.email}</p>
          <p>--------------</p>
        `;

          detailsAdherentsElement.appendChild(detailsAdherent);
        });*/
      }

      // Appelez cette fonction pour afficher les détails des adhérents dans votre interface utilisateur
      afficherDetailsAdherents();

      function Adherent(nom, prenom, email) {
        this.nom = nom;
        this.prenom = prenom;
        this.email = email;
      }

      // Création d'une liste vide d'adhérents
      let listeAdherents = [];

      const form = document.getElementById("adherentForm");
      const listeAdherentsElement = document.getElementById("listeAdherents");
      const modifierAdherentForm = document.getElementById(
        "modifierAdherentForm"
      );
      const messageModification = document.getElementById(
        "messageModification"
      );
      const messageAjout = document.getElementById("messageAjout");

      // Cette fonction supprime le contenu du message après un délai de 3 secondes
      function clearMessage(element) {
        setTimeout(function () {
          element.textContent = "";
        }, 3000);
      }

      form.addEventListener("submit", function (event) {
        event.preventDefault();

        const nom = document.getElementById("nom").value;
        const prenom = document.getElementById("prenom").value;
        const email = document.getElementById("email").value;

        if (emailExists(email)) {
          alert(
            "L'adresse email est déjà utilisée. Veuillez entrer une autre adresse email."
          );
          return;
        }

        ajouterAdherent(nom, prenom, email);
        afficherAdherents();
        form.reset();

        messageAjout.textContent = "Un nouvel adhérent a été ajouté.";
        clearMessage(messageAjout);
      });

      modifierAdherentForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const nom = document.getElementById("nomModifier").value;
        const prenom = document.getElementById("prenomModifier").value;
        const nouvelEmail = document.getElementById("nouvelEmail").value;

        modifierAdherent(nom, prenom, nouvelEmail);
        modifierAdherentForm.reset();
      });

      function ajouterAdherent(nom, prenom, email) {
        let nouvelAdherent = new Adherent(nom, prenom, email);
        // Initialise la propriété 'anciennesAdresses' pour chaque nouvel adhérent
        nouvelAdherent.anciennesAdresses = [];

        listeAdherents.push(nouvelAdherent);
      }

      function afficherAdherents() {
        listeAdherentsElement.innerHTML = "";

        listeAdherents.forEach(function (adherent, index) {
          const listItem = document.createElement("li");
          listItem.innerHTML = `Adhérent ${index + 1}:<br>Nom: ${
            adherent.nom
          }<br>Prénom: ${adherent.prenom}<br>Email: ${
            adherent.email
          }<br>--------------`;
          listeAdherentsElement.appendChild(listItem);
        });
      }

      function emailExists(email) {
        return listeAdherents.some((adherent) => adherent.email === email);
      }

    
      function updateAdherentInList(index) {
        const updatedAdherent = listeAdherents[index];
        const listItemToUpdate = listeAdherentsElement.childNodes[index];

        listItemToUpdate.innerHTML = `Adhérent ${index + 1}:<br>Nom: ${
          updatedAdherent.nom
        }<br>Prénom: ${updatedAdherent.prenom}<br>Email: ${
          updatedAdherent.email
        }<br>--------------`;
      }

      const supprimerAdherentForm = document.getElementById(
        "supprimerAdherentForm"
      );
      const messageSuppression = document.getElementById("messageSuppression");

      supprimerAdherentForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const nom = document.getElementById("nomSupprimer").value;
        const prenom = document.getElementById("prenomSupprimer").value;
        const email = document.getElementById("emailSupprimer").value;

        supprimerAdherent(nom, prenom, email);
        supprimerAdherentForm.reset();
      });

      function supprimerAdherent(nom, prenom, email) {
        let found = false;
        for (let i = 0; i < listeAdherents.length; i++) {
          if (
            listeAdherents[i].nom === nom &&
            listeAdherents[i].prenom === prenom &&
            listeAdherents[i].email === email
          ) {
            listeAdherents.splice(i, 1); // Supprime l'adhérent du tableau
            found = true;
            afficherAdherents(); // Met à jour l'affichage de la liste des adhérents
            break;
          }
        }

        if (!found) {
          messageSuppression.textContent = "Adhérent non trouvé.";
          setTimeout(() => {
            messageSuppression.textContent = "";
          }, 3000);
        } else {
          messageSuppression.textContent = `L'adhérent ${prenom} ${nom} a été supprimé.`;
          setTimeout(() => {
            messageSuppression.textContent = "";
          }, 3000);
        }
      }
    </script> 
  </body>
</html>
